<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Website - Home</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            width: 80%;
            margin: 0 auto;
        }
        .date {
            text-align: center;
            font-size: 24px;
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 15px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .task-completed {
            text-decoration: line-through;
            color: #aaa;
        }
        .progress-container {
            margin-top: 20px;
        }
        .progress-bar {
            width: 100%;
            background-color: #f3f3f3;
            border: 1px solid #000;
            margin-top: 10px;
        }
        .progress {
            width: 0;
            height: 30px;
            background-color: #4caf50;
            text-align: center;
            line-height: 30px;
            color: white;
        }
        .reward-wheel {
            margin-top: 20px;
            text-align: center;
            display: none; /* Hidden until progress bar is filled */
        }
        .add-task-form, .add-category-form, .reward-management-form {
            margin-top: 20px;
        }
        .hidden {
            display: none;
        }
        .calendar {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .calendar table {
            border-collapse: collapse;
        }
        .calendar th, .calendar td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        .calendar th {
            background-color: #f2f2f2;
        }
        .calendar td {
            cursor: pointer;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .calendar-header button {
            background-color: #f2f2f2;
            border: 1px solid #ddd;
            padding: 5px;
            cursor: pointer;
        }
        footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #f8f8f8;
            padding: 10px;
            text-align: center;
            border-top: 1px solid #ddd;
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="index-page">
    <header>
        <h1>Welcome to My Website</h1>
        <nav>
            <a href="index.html">Home</a>
            <a href="research.html">Research</a>
            <a href="blog.html">Blog</a>
            <a href="personal.html">Personal</a>
            <a href="cv.html">CV</a>
            <a href="#" onclick="showTasks()">Tasks</a>
        </nav>
    </header>
    <main>
        <div id="home-section">
            <h2>Hello, and welcome to my website!</h2>
            <p>My name is Christian Kohnle. I am a Mathematics and Physics Undergraduate Student at Boston University.</p>
            <p>Here you can find information about my research, blog posts, and personal information. If you are looking to employ me, or are just curious, my CV can be downloaded here as well.</p>
            <p>In addition, you can find links to my LinkedIn, Youtube, Github, and other ways to connect with me.</p>
            <audio id="quack-sound" src="quack.mp3"></audio>
        </div>

        <div id="tasks-section" class="hidden">
            <div class="container">
                <div class="calendar-header">
                    <button onclick="changeMonth(-1)">&#8249;</button>
                    <span id="calendar-month-year"></span>
                    <button onclick="changeMonth(1)">&#8250;</button>
                </div>
                <div class="calendar" id="calendar"></div>
                <div class="date">Date: <span id="date-today"></span></div>
                
                <table id="task-table">
                    <tr>
                        <th>Task</th>
                        <th>Significance</th>
                        <th>Category</th>
                        <th>Points Gained</th>
                        <th>Complete</th>
                        <th>Remove</th>
                    </tr>
                </table>

                <div class="progress-container" id="progress-container">
                    <!-- Progress bars for categories will be dynamically generated here -->
                </div>

                <div class="add-task-form">
                    <h3>Add New Task</h3>
                    <input type="text" id="new-task" placeholder="Task description">
                    <select id="new-task-significance">
                        <option value="daily">Daily</option>
                        <option value="minor">Minor</option>
                        <option value="major">Major</option>
                        <option value="massive">Massive</option>
                    </select>
                    <select id="new-task-category">
                        <option value="General">General</option>
                        <!-- Categories will be dynamically added here -->
                    </select>
                    <button onclick="addTask()">Add Task</button>
                </div>

                <div class="add-category-form">
                    <h3>Add New Category</h3>
                    <input type="text" id="new-category" placeholder="Category name">
                    <button onclick="addCategory()">Add Category</button>
                </div>

                <div class="reward-management-form hidden" id="reward-management-form">
                    <h3>Manage Rewards for <span id="reward-category-name"></span></h3>
                    <input type="text" id="new-reward" placeholder="Reward description">
                    <button onclick="addReward()">Add Reward</button>
                    <div id="reward-list">
                        <!-- Rewards will be dynamically listed here -->
                    </div>
                </div>

                <div class="remove-category-form">
                    <h3>Remove Category</h3>
                    <select id="remove-category-select">
                        <!-- Categories will be dynamically added here -->
                    </select>
                    <button onclick="removeCategory()">Remove Category</button>
                </div>
            </div>
        </div>
    </main>
    <footer id="footer">
        <a href="https://www.linkedin.com/in/christian-kohnle-phys/" target="_blank" rel="noopener noreferrer">
            <img src="LinkedIn_logo.png" alt="LinkedIn" width="32" height="32">
        </a>
        <a href="https://www.youtube.com/channel/UCp4eVMSIq-zZgiTZfk4Yx_Q" target="_blank" rel="noopener noreferrer">
            <img src="YouTube_logo.png" alt="YouTube" width="32" height="32">
        </a>
        <p>&copy; 2024 Christian Kohnle. All rights reserved.</p>
    </footer>

    <script>
        const taskSignificancePoints = {
            daily: 1,
            minor: 5,
            major: 10,
            massive: 25
        };

        let tasks = JSON.parse(localStorage.getItem('tasks')) || {};
        let categories = JSON.parse(localStorage.getItem('categories')) || [{ name: 'General', rewards: [] }];

        // Filter out undefined or invalid categories
        categories = categories.filter(category => category && category.name);

        let selectedDate = new Date().toISOString().split('T')[0]; // Default to today's date
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let categoryPoints = {};
        let progressBars = {};

        categories.forEach(category => {
            categoryPoints[category.name] = 0;
        });

        const progressBarContainer = document.getElementById('progress-container');

        function renderProgressBars() {
            progressBarContainer.innerHTML = '';
            categories.forEach(category => {
                const progressBarWrapper = document.createElement('div');
                progressBarWrapper.innerHTML = `
                    <div>${category.name} Progress:</div>
                    <div class="progress-bar" id="progress-bar-${category.name}">
                        <div class="progress" id="progress-${category.name}">0%</div>
                    </div>
                    <div class="reward-wheel" id="reward-wheel-${category.name}">
                        <button onclick="spinRewardWheel('${category.name}')">Spin ${category.name} Reward Wheel</button>
                        <div id="reward-result-${category.name}"></div>
                        <button onclick="manageRewards('${category.name}')">Manage ${category.name} Rewards</button>
                    </div>
                `;
                progressBarContainer.appendChild(progressBarWrapper);
                progressBars[category.name] = document.getElementById(`progress-${category.name}`);
                updateProgressBarVisibility(category.name);
            });
            updateProgressBars();
            renderCategoryOptions(); // Update category options in remove category dropdown
        }

        function updateProgressBarVisibility(categoryName) {
            const rewardWheel = document.getElementById(`reward-wheel-${categoryName}`);
            if (categoryPoints[categoryName] >= 100) {
                rewardWheel.style.display = 'block';
            } else {
                rewardWheel.style.display = 'none';
            }
        }

        function renderCategoryOptions() {
            const categorySelect = document.getElementById('new-task-category');
            const removeCategorySelect = document.getElementById('remove-category-select');
            categorySelect.innerHTML = '';
            removeCategorySelect.innerHTML = '';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.name;
                option.textContent = category.name;
                categorySelect.appendChild(option);

                const removeOption = document.createElement('option');
                removeOption.value = category.name;
                removeOption.textContent = category.name;
                removeCategorySelect.appendChild(removeOption);
            });
        }

        function renderTasks() {
            const taskTable = document.getElementById('task-table');
            taskTable.innerHTML = `
                <tr>
                    <th>Task</th>
                    <th>Significance</th>
                    <th>Category</th>
                    <th>Points Gained</th>
                    <th>Complete</th>
                    <th>Remove</th>
                </tr>
            `;
            if (tasks[selectedDate]) {
                tasks[selectedDate].forEach((task, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="${task.completed ? 'task-completed' : ''}">${task.description}</td>
                        <td>${task.significance}</td>
                        <td>${task.category}</td>
                        <td>${taskSignificancePoints[task.significance]}</td>
                        <td><input type="checkbox" ${task.completed ? 'checked' : ''} onclick="completeTask(${index})"></td>
                        <td><button onclick="removeTask(${index})">Remove</button></td>
                    `;
                    taskTable.appendChild(row);
                });
            }
            updateTotalPoints();
        }

        function completeTask(index) {
            const task = tasks[selectedDate][index];
            const points = taskSignificancePoints[task.significance];
            task.completed = !task.completed;
            if (task.completed) {
                addPoints(task.category, points);
                if (task.category !== 'General') {
                    addPoints('General', points);
                }
            } else {
                subtractPoints(task.category, points);
                if (task.category !== 'General') {
                    subtractPoints('General', points);
                }
            }
            renderTasks();
            saveTasks();
        }

        function removeTask(index) {
            tasks[selectedDate].splice(index, 1);
            renderTasks();
            saveTasks();
        }

        function addPoints(category, points) {
            categoryPoints[category] += points;
            if (categoryPoints[category] >= 100) {
                categoryPoints[category] -= 100;
                alert(`Congratulations! You have reached 100% in the ${category} category!`);
            }
            updateProgressBars();
            updateProgressBarVisibility(category);
        }

        function subtractPoints(category, points) {
            categoryPoints[category] -= points;
            if (categoryPoints[category] < 0) {
                categoryPoints[category] = 0;
            }
            updateProgressBars();
        }

        function updateProgressBars() {
            categories.forEach(category => {
                const progress = (categoryPoints[category.name] / 100) * 100;
                progressBars[category.name].style.width = progress + '%';
                progressBars[category.name].textContent = progress + '%';
                updateProgressBarVisibility(category.name);
            });
        }

        function spinRewardWheel(categoryName) {
            const category = categories.find(c => c.name === categoryName);
            if (category && category.rewards.length > 0) {
                const reward = category.rewards[Math.floor(Math.random() * category.rewards.length)];
                document.getElementById(`reward-result-${categoryName}`).textContent = `You won: ${reward}`;
                // Hide the wheel spin button after use
                document.getElementById(`reward-wheel-${categoryName}`).style.display = 'none';
            } else {
                alert(`No rewards available for ${categoryName}`);
            }
        }

        function manageRewards(categoryName) {
            const rewardManagementForm = document.getElementById('reward-management-form');
            const rewardCategoryName = document.getElementById('reward-category-name');
            rewardCategoryName.textContent = categoryName;
            rewardManagementForm.classList.remove('hidden');

            renderRewardList(categoryName);
        }

        function renderRewardList(categoryName) {
            const rewardList = document.getElementById('reward-list');
            const category = categories.find(c => c.name === categoryName);
            rewardList.innerHTML = '';
            category.rewards.forEach((reward, index) => {
                const rewardItem = document.createElement('div');
                rewardItem.textContent = reward;
                const removeButton = document.createElement('button');
                removeButton.textContent = 'Remove';
                removeButton.onclick = () => removeReward(categoryName, index);
                rewardItem.appendChild(removeButton);
                rewardList.appendChild(rewardItem);
            });
        }

        function addReward() {
            const rewardDescription = document.getElementById('new-reward').value;
            const categoryName = document.getElementById('reward-category-name').textContent;
            const category = categories.find(c => c.name === categoryName);

            if (rewardDescription && category) {
                category.rewards.push(rewardDescription);
                renderRewardList(categoryName);
                saveCategories();
            }
        }

        function removeReward(categoryName, index) {
            const category = categories.find(c => c.name === categoryName);
            if (category) {
                category.rewards.splice(index, 1);
                renderRewardList(categoryName);
                saveCategories();
            }
        }

        function addTask() {
            const description = document.getElementById('new-task').value;
            const significance = document.getElementById('new-task-significance').value;
            const category = document.getElementById('new-task-category').value;
            if (description && significance && category) {
                if (!tasks[selectedDate]) {
                    tasks[selectedDate] = [];
                }
                tasks[selectedDate].push({ description, significance, category, completed: false });
                renderTasks();
                saveTasks();
            }
        }

        function addCategory() {
            const categoryName = document.getElementById('new-category').value;
            if (categoryName && !categories.some(c => c.name === categoryName)) {
                categories.push({ name: categoryName, rewards: [] });
                categoryPoints[categoryName] = 0;
                renderProgressBars();
                saveCategories();
            }
        }

        function removeCategory() {
            const categoryName = document.getElementById('remove-category-select').value;
            if (categoryName && categories.length > 1) { // Prevent removing all categories
                categories = categories.filter(c => c.name !== categoryName);
                delete categoryPoints[categoryName];
                renderProgressBars();
                renderCategoryOptions(); // Refresh the dropdowns
                saveCategories();
            } else {
                alert("Cannot remove the last category.");
            }
        }

        function showTasks() {
            const password = prompt("Enter password to access tasks:");
            if (password === "yourpassword") {
                document.getElementById('home-section').classList.add('hidden');
                document.getElementById('tasks-section').classList.remove('hidden');
                renderCalendar();
                renderTasks();
                renderProgressBars();
                renderCategoryOptions();
            } else {
                alert("Incorrect password!");
            }
        }

        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }

        function saveCategories() {
            localStorage.setItem('categories', JSON.stringify(categories));
        }

        function renderCalendar() {
            const calendarElement = document.getElementById('calendar');
            document.getElementById('calendar-month-year').textContent = `${new Date(currentYear, currentMonth).toLocaleString('default', { month: 'long' })} ${currentYear}`;
            calendarElement.innerHTML = generateCalendar(currentMonth, currentYear);
            document.getElementById('date-today').textContent = new Date(selectedDate).toDateString();
        }

        function generateCalendar(month, year) {
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = 32 - new Date(year, month, 32).getDate();

            let calendar = `<table>
                <tr>
                    <th>Su</th>
                    <th>Mo</th>
                    <th>Tu</th>
                    <th>We</th>
                    <th>Th</th>
                    <th>Fr</th>
                    <th>Sa</th>
                </tr><tr>`;

            for (let i = 0; i < firstDay; i++) {
                calendar += "<td></td>";
            }

            for (let day = 1; day <= daysInMonth; day++) {
                if ((firstDay + day - 1) % 7 === 0 && day !== 1) {
                    calendar += "</tr><tr>";
                }

                calendar += `<td onclick="selectDate(${year}, ${month}, ${day})">${day}</td>`;
            }

            calendar += "</tr></table>";

            return calendar;
        }

        function selectDate(year, month, day) {
            // Fix the calendar date issue by using correct month and day parameters
            selectedDate = new Date(year, month, day).toISOString().split('T')[0];
            document.getElementById('date-today').textContent = new Date(selectedDate).toDateString();
            renderTasks();
        }

        function changeMonth(offset) {
            currentMonth += offset;

            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear -= 1;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear += 1;
            }

            renderCalendar();
        }

        window.addEventListener('scroll', () => {
            const footer = document.getElementById('footer');
            if (window.scrollY > 50) {
                footer.style.transform = 'translateY(100%)';
            } else {
                footer.style.transform = 'translateY(0)';
            }
        });

        renderProgressBars();
        renderCategoryOptions();
        renderCalendar();
        renderTasks();
    </script>
</body>
</html>
